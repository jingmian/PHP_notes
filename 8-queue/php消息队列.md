## 消息队列的概念、原理和场景

### 1. 消息队列概念

1. 队列结构的中间件

2. 消息放入后，不需要立即处理

3. 由订阅者/消费者按顺序处理

### 2.核心结构

![image-20200615131619746](https://i.loli.net/2020/06/15/K8nBeCdPWlTEHrs.png)

### 3.应用场景

- 数据需要冗余

  数据持久化存储到队列中，保证每条数据都处理成功

- 系统解耦

  入队系统和出队系统没有直接关系，崩溃不会直接影响其他系统

- 流量削峰

  防止秒杀系统高并发情况下崩溃

- 异步通信

  异步场景可以使用消息队列

- 扩展性

  订单与退货系统，订阅消息队列可拓展业务

- 排序保证

  队列单进单出特性

### 4.队列介质

- Mysql：可靠性高、易实现，速度慢
- Redis：速度快，单条大消息包时效率低
- 消息系统：RabbitMQ专业性强、可靠，学习成本高

### 5.消息处理触发机制

- 死循环方式读取：易实现，故障时无法及时恢复
- 定时任务：压力均分，有处理量上限
- 守护进程：类似于PHP-FPM和PHP-CG，需要shell基础

## 解耦案例:队列处理订单系统和配送系统

### 1.架构设计

![image-20200615132846768](https://i.loli.net/2020/06/15/TPmZx21sNwkjAcn.png)

### 2.程序流程

![image-20200615132924454](https://i.loli.net/2020/06/15/wlA1M3Ru8IT6xQg.png)

## 流量削峰案例: Redis的List类型实现秒杀

## RabbitMQ :更专业的消息系统实现方案